(function(){"use strict";function t(e,t,n,r,i,s){var o=t.split(" "),u="";for(var a=0;a<o.length;a++){var f=u+o[a]+" ",l=e.measureText(f),c=l.width;c>i?(e.fillText(u,n,r),u=o[a]+" ",r+=s):u=f}return e.fillText(u,n,r),r}function n(){this.autodraw=!0}var e={run:function(t,n){var r,i=this;typeof t=="function"&&(n=t,t={}),r=document.getElementsByTagName("canvas")[0],this.clear=t.clear===undefined?!0:t.clear,this.canvas=t.canvas||r,this.state=t.state,this.canvas.addEventListener("mousemove",this._mouse.mousemove),this.canvas.addEventListener("mousedown",this._mouse.mousedown),this.canvas.addEventListener("mouseup",this._mouse.mouseup),this.ctx=this.canvas.getContext("2d"),this.ctx.drawCircle=function(e,t,n){this.beginPath(),this.arc(e,t,n,0,Math.PI*2,!0),this.closePath(),this.fill()},this.canvas.ctx=this.ctx,setInterval(function(){var t;i.clear&&i.ctx.clearRect(0,0,i.canvas.width,i.canvas.height);if(i.percentLoaded()==="100%"||i.percentLoaded()==="NaN%")for(t in i.collections)i.collections.hasOwnProperty(t)&&i.collections[t].step();i.state&&i.states[i.state].call(i),n&&n.call(i),e.mouse.click=!1},t.time||30)},mouse:{},_mouse:{mousemove:function(t){var n,r;t.offsetX?(n=t.offsetX,r=t.offsetY):t.layerX&&(n=t.layerX-e.canvas.offsetLeft,r=t.layerY-e.canvas.offsetTop),e.mouse.x=n/e.ratio.x,e.mouse.y=r/e.ratio.y},mousedown:function(){e.mouse.click=!0,e.mouse.isDown=!0},mouseup:function(){e.mouse.isDown=!1}},sounds:{},images:{},audioLoad:function(e){var t,n,r,i,s=this;r=function(){this.pause(),this.currentTime=0},i=function(){return new function(){this._loaded||(s._loading-=1,this._loaded=1)}};for(t in e)e.hasOwnProperty(t)&&(n=new Audio,n.stop=r,n.oncanplaythrough=i(),n.src=e[t],this.sounds[t]=n,s._loading+=1)},imageLoad:function(e){var t,n,r,i=this;r=function(){i._loading-=1,this._loaded=1};for(n in e)e.hasOwnProperty(n)&&(t=new Image,t.src=e[n],t.onload=r,this.images[n]=t,i._loading+=1)},_loading:0,percentLoaded:function(){var e,t,n,r;return t=Object.keys(this.images).length,n=Object.keys(this.sounds).length,e=t+n,r=(e-this._loading)/e,r*=1e4,r=Math.round(r)/100,r+"%"},filesLoading:function(){var e,t,n=[],r=[];for(e in this.images)this.images[e]._loaded||n.push(e);for(t in this.sounds)this.sounds[t]._loaded||r.push(t);return{sounds:r,images:n}},fullscreen:function(){var e=this.canvas;e.requestFullScreenWithKeys?e.requestFullScreenWithKeys():e.mozRequestFullScreen?e.mozRequestFullScreen(e.ALLOW_KEYBOARD_INPUT):e.webkitRequestFullScreen&&e.webkitRequestFullScreen(e.ALLOW_KEYBOARD_INPUT)},collections:{},setupCollections:function(e){var t,n=this;for(t in e)e.hasOwnProperty(t)&&(n.collections[t]=new e[t])},states:{},setupStates:function(e){var t,n=this;for(t in e)e.hasOwnProperty(t)&&(n.states[t]=e[t])},ratio:{x:1,y:1},onInFullScreen:function(){var e,t,n;n=this.canvas,e=document.getElementsByTagName("html")[0],t=document.getElementsByTagName("body")[0],e.className+=" ffs_body",t.className+=" ffs_body",n.className+=" ffs_element",this.ratio={x:window.innerWidth/this.canvas.width,y:window.innerHeight/this.canvas.height}},onOutFullScreen:function(){var e,t,n;n=this.canvas,e=document.getElementsByTagName("html")[0],t=document.getElementsByTagName("body")[0],e.className=e.className.replace("ffs_body",""),t.className=t.className.replace("ffs_body",""),n.className=n.className.replace("ffs_element",""),this.ratio={x:1,y:1}},drawText:function(n,r,i,s,o,u){var a,f=this;typeof n=="string"&&(n=n.split("\n")),this.ctx.fillStyle=s||"black",this.ctx.font=o||"12px sans-serif",u=u||this.canvas.width-r,a=+(this.ctx.font.match(/(\d+)px/)[1]||12),n.forEach(function(n){i=t(e.ctx,n,r,i,u,a),i+=a})},drawMouse:function(e,t,n){var r,i,s=this.images[e];t!==undefined&&n!==undefined?(r=this.mouse.x-t,i=this.mouse.y-n):(r=this.mouse.x-s.width/2,i=this.mouse.y-s.height/2),this.ctx.drawImage(s,r,i)},Key:{_pressed:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,W:87,S:83,A:65,D:68,SPACE:32,isDown:function(e){return this._pressed[e]},onKeydown:function(e){this._pressed[e.keyCode]=!0},onKeyup:function(e){delete this._pressed[e.keyCode]}},_items:{},getOrCreate:function(e,t,n){if(!this._items.hasOwnProperty(e)||n)this._items[e]=t();return this._items[e]}};window.addEventListener("keyup",function(t){e.Key.onKeyup(t)},!1),window.addEventListener("keydown",function(t){e.Key.onKeydown(t)},!1),document.addEventListener("fullscreenchange",function(){var t=document.fullscreen?"onInFullScreen":"onOutFullScreen";e[t]()},!1),document.addEventListener("mozfullscreenchange",function(){var t=document.mozFullScreen?"onInFullScreen":"onOutFullScreen";e[t]()},!1),document.addEventListener("webkitfullscreenchange",function(){var t=document.webkitIsFullScreen?"onInFullScreen":"onOutFullScreen";e[t]()},!1),n.prototype.draw=function(){},n.prototype.change=function(){},n.prototype.step=function(){this.img&&this.autodraw&&this.drawImage(),this.draw(),this.change()},n.prototype.isOutOfBounds=function(){var t=this.x>e.canvas.width,n=this.x+this.width<0,r=this.y+this.height<0,i=this.y>e.canvas.height;return t||i||r||n},n.prototype.isHover=function(){var t,n;return t=e.mouse.x>this.x&&e.mouse.x<this.width+this.x,n=e.mouse.y>this.y&&e.mouse.y<this.height+this.y,t&&n},n.prototype.isClicked=function(){return e.mouse.click&&this.isHover()},n.prototype.isMouseDown=function(){return e.mouse.isDown&&this.isHover()},n.prototype.isDragged=function(){var t=this.isMouseDown()||this._dragged&&e.mouse.isDown;return this._dragged=t,t},n.prototype.drawImage=function(){e.ctx.drawImage(e.images[this.img],this.x,this.y,this.width,this.height)},n.prototype.isColliding=function(e){var t=this.x,n=this.y,r=this.width,i=this.height,s=e.x,o=e.y,u=e.width,a=e.height;if(u!==Infinity&&r!==Infinity){u+=s,r+=t;if(isNaN(r)||isNaN(u)||s>r||t>u)return!1}if(o!==Infinity&&i!==Infinity){a+=o,i+=n;if(isNaN(i)||isNaN(o)||o>i||n>a)return!1}return this},n.extend=function(e){var t,n=this,r=e.init||function(){};r.prototype=new n;for(t in e)e.hasOwnProperty(t)&&t!=="init"&&(r.prototype[t]=e[t]);return r.extend=this.extend,r},e.Base=n,e.Collection=n.extend({init:function(){this.collection=[]},step:function(){this.drawCollection(),this.filterCollection(),this.draw(),this.change()},drawCollection:function(){this.collection.forEach(function(e){e.step()})},filterCollection:function(){this.filter&&(this.collection=this.collection.filter(this.filter))},add:function(){this.collection.push(new this.model)},remove:function(e){return this.collection.splice(e,1)},isColliding:function(e){var t,n;for(t=0;t<this.collection.length;t++){n=this.collection[t].isColliding(e);if(n)return n}return!1}}),e.Animated=e.Base.extend({offsetX:0,offsetY:0,isFinished:!1,stepStart:0,stepFrequency:1,step:function(){this.stepStart+=1,this.drawFrame(),this.stepStart%this.stepFrequency===0&&this.animate(),this.draw(),this.change()},animate:function(){var t=e.images[this.img];this.offsetX+=this.width,this.offsetX==t.width&&(this.offsetX=0,this.offsetY+=this.height),this.offsetY==t.height&&(this.repeat?this.offsetY=0:this.isFinished=!0)},drawFrame:function(){var t,n,r,i,s,o,u;t=e.images[this.img],n=this.offsetX,r=this.offsetY,i=this.width,s=this.height,o=this.x,u=this.y,e.ctx.drawImage(t,n,r,i,s,o,u,i,s)}}),this.Juicy=e}).call(this);